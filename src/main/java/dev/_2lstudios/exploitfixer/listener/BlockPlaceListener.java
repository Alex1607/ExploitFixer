package dev._2lstudios.exploitfixer.listener;

import org.bukkit.block.Block;
import org.bukkit.block.BlockFace;
import org.bukkit.block.data.Ageable;
import org.bukkit.block.data.BlockData;
import org.bukkit.block.data.type.Bed;
import org.bukkit.event.EventHandler;
import org.bukkit.event.EventPriority;
import org.bukkit.event.Listener;
import org.bukkit.event.block.BlockPlaceEvent;

import dev._2lstudios.exploitfixer.managers.ModuleManager;
import dev._2lstudios.exploitfixer.modules.PatcherModule;

public class BlockPlaceListener implements Listener {
    private PatcherModule patcherModule;

    public BlockPlaceListener(ModuleManager moduleManager) {
        this.patcherModule = moduleManager.getPatcherModule();
    }

    @EventHandler(ignoreCancelled = true, priority = EventPriority.LOWEST)
    public void onBlockPlace(BlockPlaceEvent event) {
        // Check if patching of duplication beds is enabled
        if (patcherModule.isBedDuplication()) {
            // Get block
            Block block = event.getBlock();

            // Get the block data
            BlockData blockData = block.getBlockData();

            // Check if block type is bed
            if (blockData instanceof Bed) {
                // Get the block below the placed bed
                Block blockBelow = block.getRelative(BlockFace.DOWN);

                // Get the block below data
                BlockData blockBelowData = blockBelow.getBlockData();

                // Check if the block below is ageable (growing crops)
                if (blockBelowData instanceof Ageable) {
                    // Cancel the event
                    event.setCancelled(true);
                }
            }
        }
    }
}
