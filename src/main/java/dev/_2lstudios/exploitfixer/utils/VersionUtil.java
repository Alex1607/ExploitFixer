package dev._2lstudios.exploitfixer.utils;

import java.lang.reflect.Method;

import org.bukkit.entity.Player;
import org.bukkit.entity.Player.Spigot;

public class VersionUtil {
	private static Method getLocalePlayerMethod = null;
	private static Method getLocaleSpigotMethod = null;

	private static Method getLocalePlayerMethod() throws NoSuchMethodException, SecurityException {
		return getLocalePlayerMethod == null ? getLocalePlayerMethod = Player.class.getMethod("getLocale")
				: getLocalePlayerMethod;
	}

	private static Method getLocaleSpigotMethod() throws NoSuchMethodException, SecurityException {
		return getLocaleSpigotMethod == null ? getLocaleSpigotMethod = Spigot.class.getMethod("getLocale")
				: getLocaleSpigotMethod;
	}

	public static String getLocale(Player player) {
		String locale;

		try {
			Method getLocaleMethod = getLocalePlayerMethod();

			getLocaleMethod.setAccessible(true);

			locale = getLocaleMethod.invoke(player).toString();
		} catch (Exception exception) {
			try {
				Method getLocaleMethod = getLocaleSpigotMethod();

				getLocaleMethod.setAccessible(true);

				locale = getLocaleMethod.invoke(player.spigot()).toString();
			} catch (Exception exception1) {
				locale = "en";
			}
		}

		if (locale != null && locale.length() > 1) {
			locale = locale.substring(0, 2);
		} else {
			locale = "en";
		}

		return locale;
	}
}